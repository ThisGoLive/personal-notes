# 第五章(四) #
## 高可用的网站软件质量 ##
### 自动化发布 ###
网站发布频繁,发不前多份代码肯能会发生冲突,而每次发布相当于异常宕机事故.因此网站发布荆棘丛生.

火车发布模型,基于规则驱动的流程,所以这个流程可以自动化.采用火车发布模型的网站会开发一个自动化发布的工具实现发布过程的自动化.
### 灰度发布 ###
应用发布成功后,仍然可能发现应为软件问题而引入的故障,这时就需要做发布回滚,即卸载刚刚发布的软件,将上一个版本的软件包重新发布,使系统复原,消除故障.
## 网站运行监控 ##
**不允许没有监控的系统上线,**这是许多网站架构师在做项目上线评审时常说的.网站运维和架构设计优化至关重要,运维没有监控的网站,犹如驾驶没有仪表的飞机.
### 监控数据采集 ###
#### **1.用户行为日志收集**: ####
**服务器端日志收集:**这个方案简单,Apache等几乎所有web服务器都具备日志记录功能,可以记录大部分用户行为日志,开启web服务器的日志记录功能即可.

**客户端浏览器日志收集:**利用页面嵌入专门的javascrip脚本可以收集用户真实的操作行为,因此比服务器日志收集更加准确.缺点是比较麻烦,需要在页面嵌入特定的JavaScript脚本完成.
#### 2.服务器性能监控 ####
收集服务器性能指标,如系统Load,内存占用.....及时判断应用状态,防患于未然,将故障扼杀在萌芽期非常重要.

目前使用较广泛的开源性能监控工具是Ganglia,它支持大规模服务器集群,并支持以图形的方式在浏览器展示实时性能曲线.
#### 3.运行数据报告 ####
除了服务器系统性能监控,网站还需要监控一些与具体业务场景相关的技术和业务指标,比如缓冲命中率,平均响应延迟时间,每分钟发送邮件数目等..
### 监控管理 ###
监控数据采集后,除了用作西永新能评估,集群规模伸缩性能预测等,还可以进行分析预警,并对服务进行失效转移,自动负载调整,最大利用集群所有机器的资源
#### 系统报警 ####
在服务器运行正常情况下,各项监控指标基本稳定在一个特定的水平,如果这些指标超过某个阀值,就意味这系统肯能将要出现故障,这时需要对象相关人员报警,及时采取措施.
#### 失效转移 ####
除了应用程序访问失败时进行失效转移,监控系统还可以在发现故障的情况下主动通知应用.进行失效转移.
#### 自动优雅降级 ####
是指网站为了应付突然爆发的访问高峰,主动关闭部分功能,释放部分系统资源,保证网站的核心功能正常访问的一个手段.