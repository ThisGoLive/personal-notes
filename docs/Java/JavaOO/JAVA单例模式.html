<html>
<head>
  <title>JAVA 单例模式的实现方式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/276742; Windows/10.0.10240 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1434"/>

<div>
<span><div style="border: 1px dotted rgb(189, 205, 238); padding: 20px; color: rgb(75, 75, 75); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: white;"><div><b><span style="font-size: 24px;">JAVA 单例模式的实现方式</span></b></div><div><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><b><span style="color: rgb(255, 0, 0);"><br/></span></b></span></div><div><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><b><span style="color: rgb(255, 0, 0);"><br/></span></b></span></div><div><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><strong><span style="font-size: medium;"><span style="color: rgb(255, 0, 0);"><font size="3">第一种（懒汉，线程不安全）：</font></span></span></strong></span></div><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton instance;  <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></span></font>Singleton (){}   <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton getInstance() {  <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);"> (instance </span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">) {  <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">        instance </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> instance;  <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">11</span> </span></div><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"></p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;">这种写法lazy loading很明显，但是致命的是在多线程不能正常工作。<br/><br/></span><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="font-size: medium;"><span style="color: rgb(255, 0, 0);"><font size="3"><strong>第二种（懒汉，线程安全）：<br/></strong></font></span></span></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><font size="3"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton instance;  <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></span></font>Singleton (){}<br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">synchronized</span><span style="color: rgb(0, 0, 0);"> Singleton getInstance() {  <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);"> (instance </span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">) {  <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">        instance </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> instance;  <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">11</span> </font></span></div><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;">这种写法能够在多线程中很好的工作，而且看起来它也具备很好的lazy loading，但是，遗憾的是，效率很低，99%情况下不需要同步。<br/><br/><span style="color: rgb(0, 0, 0); font-size: 10pt;"><strong style="font-weight: bold;"><span style="color: rgb(255, 0, 0); font-size: medium;">第三种（饿汉）：</span></strong></span></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><font size="2"><span style="color: rgb(0, 128, 128);">1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);">2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton instance </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);">3</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></span></font>Singleton (){}<br/></span><span style="color: rgb(0, 128, 128);">4</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton getInstance() {  <br/></span><span style="color: rgb(0, 128, 128);">5</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> instance;  <br/></span><span style="color: rgb(0, 128, 128);">6</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">7</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">8</span> </font></span></div><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;">这种方式基于<span style="color: rgb(0, 0, 0);">classloder</span><span style="color: rgb(0, 0, 0);">机制避免了多线程的同步问题，不过，</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">在类装载时就实例化，虽然导致类装载的原因有很多种，在单例模式中大多数都是调用</span><span style="color: rgb(0, 0, 0);">getInstance</span><span style="color: rgb(0, 0, 0);">方法，</span> <span style="color: rgb(0, 0, 0);">但是也不能确定有其他的方式（或者其他的静态方法）导致类装载，这时候初始化</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">显然没有达到</span><span style="color: rgb(0, 0, 0);">lazy loading</span><span style="color: rgb(0, 0, 0);">的效果。<br/><br/></span></span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><font size="2"><span style="color: rgb(255, 0, 0); font-size: medium;"><strong style="font-weight: bold;">第四种（<span style="color: rgb(0, 0, 0); font-size: 12px; font-weight: normal;"><strong style="font-weight: bold;"><span style="color: rgb(255, 0, 0); font-size: medium;">饿</span></strong></span>汉，变种）：</strong></span></font></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><font size="2"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> Singleton instance </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">;  <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> {  <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">    instance </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></span></font>Singleton (){}<br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton getInstance() {  <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">.instance;  <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">11</span> </font></span></div><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><font size="2">表面上看起来差别挺大，其实更第三种方式差不多，都是在类初始化即实例化instance。</font><br/><br/></span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="color: rgb(255, 0, 0); font-size: medium;"><strong style="font-weight: bold;">第五种（静态内部类）：<br/></strong></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> SingletonHolder {  <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">final</span><span style="color: rgb(0, 0, 0);"> Singleton INSTANCE </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></span></font>Singleton (){}<br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">final</span><span style="color: rgb(0, 0, 0);"> Singleton getInstance() {  <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">        </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> SingletonHolder.INSTANCE;  <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">10</span> </span></div><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"> </p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><font size="2"><span style="color: rgb(0, 0, 0);">这种方式同样利用了</span><span style="color: rgb(0, 0, 0);">classloder</span><span style="color: rgb(0, 0, 0);">的机制来保证初始化</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">时只有一个线程，它跟第三种和第四种方式不同的是（很细微的差别）：第三种和第四种方式是只要</span><span style="color: rgb(0, 0, 0);">Singleton</span><span style="color: rgb(0, 0, 0);">类被装载了，那么</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">就会被实例化（没有达到</span><span style="color: rgb(0, 0, 0);">lazy loading</span><span style="color: rgb(0, 0, 0);">效果），而这种方式是</span><span style="color: rgb(0, 0, 0);">Singleton</span><span style="color: rgb(0, 0, 0);">类被装载了，</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">不一定被初始化。因为</span><span style="color: rgb(0, 0, 0);">SingletonHolder</span><span style="color: rgb(0, 0, 0);">类没有被主动使用，只有显示通过调用</span><span style="color: rgb(0, 0, 0);">getInstance</span><span style="color: rgb(0, 0, 0);">方法时，才会显示装载</span><span style="color: rgb(0, 0, 0);">SingletonHolder</span><span style="color: rgb(0, 0, 0);">类，从而实例化</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">。想象一下，如果实例化</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">很消耗资源，我想让他延迟加载，另外一方面，我不希望在</span><span style="color: rgb(0, 0, 0);">Singleton</span><span style="color: rgb(0, 0, 0);">类加载时就实例化，因为我不能确保</span><span style="color: rgb(0, 0, 0);">Singleton</span><span style="color: rgb(0, 0, 0);">类还可能在其他的地方被主动使用从而被加载，那么这个时候实例化</span><span style="color: rgb(0, 0, 0);">instance</span><span style="color: rgb(0, 0, 0);">显然是不合适的。这个时候，这种方式相比第三和第四种方式就显得很合理。<br/><br/></span></font></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><font size="2"><strong style="font-weight: bold;"><span style="color: rgb(255, 0, 0); font-size: medium;">第六种（枚举）：</span></strong></font></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);">1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">enum</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);">2</span> <span style="color: rgb(0, 0, 0);">    INSTANCE;  <br/></span><span style="color: rgb(0, 128, 128);">3</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);"> whateverMethod() {  <br/></span><span style="color: rgb(0, 128, 128);">4</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">5</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">6</span> </span></div><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 0, 0); font-size: 10pt;">这种方式是Effective Java作者Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还能防止反序列化重新创建新的对象，可谓是很坚强的壁垒啊，不过，个人认为由于1.5中才加入enum特性，用这种方式写不免让人感觉生疏，在实际工作中，我也很少看见有人这么写过。</span><br/>
 </span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="color: rgb(255, 0, 0); font-size: medium;"><strong style="font-weight: bold;">第七种（双重校验锁）：<br/></strong></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton {  <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">volatile</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton singleton;  <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">    <font color="#7F0055"><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span></font>Singleton (){}   <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton getSingleton() {  <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);"> (singleton </span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">) {  <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">        </span><span style="color: rgb(0, 0, 255);">synchronized</span><span style="color: rgb(0, 0, 0);"> (Singleton.</span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);">) {  <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">        </span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);"> (singleton </span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">) {  <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">            singleton </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();  <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">        }  <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">        }  <br/></span><span style="color: rgb(0, 128, 128);">11</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">12</span> <span style="color: rgb(0, 0, 0);">    </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> singleton;  <br/></span><span style="color: rgb(0, 128, 128);">13</span> <span style="color: rgb(0, 0, 0);">    }  <br/></span><span style="color: rgb(0, 128, 128);">14</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">15</span> </span></div><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;">这个是第二种方式的升级版，俗称双重检查锁定，详细介绍请查看：<a href="http://www.ibm.com/developerworks/cn/java/j-dcl.html" style="color: rgb(98, 0, 145); text-decoration: underline;"><span style="color: rgb(0, 0, 0); font-size: 10pt;">http://www.ibm.com/developerworks/cn/java/j-dcl.html</span></a></span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="color: rgb(0, 0, 0); font-size: 10pt;">在JDK1.5之后，双重检查锁定才能够正常达到单例效果。<br/><br/></span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><strong style="font-weight: bold;"><span style="font-size: large;"><span style="color: rgb(0, 0, 255);"><font size="2">总结</font></span></span></strong></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="font-size: 10pt;">有两个问题需要注意：</span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="font-size: 10pt;">     1、如果单例由不同的类装载器装入，那便有可能存在多个单例类的实例。假定不是远端存取，例如一些<span lang="EN-US"><font size="2"><span style="font-size: 10pt;">servlet</span></font></span></span><span style="font-size: 10pt;">容器对每个<span lang="EN-US"><font size="2"><span style="font-size: 10pt;">servlet</span></font></span></span><span style="font-size: 10pt;">使用完全不同的类  装载器，这样的话如果有两个<span lang="EN-US"><font size="2"><span style="font-size: 10pt;">servlet</span></font></span></span><span style="font-size: 10pt;">访问一个单例类，它们就都会有各自的实例。</span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="font-size: 10pt;">     2、如果<span lang="EN-US"><font size="2"><span style="font-size: 10pt;">Singleton</span></font></span></span><span style="font-size: 10pt;">实现了<span lang="EN-US"><font size="2"><span style="font-size: 10pt;">java.io.Serializable</span></font></span></span><span style="font-size: 10pt;">接口，那么这个类的实例就可能被序列化和复原。不管怎样，如果你序列化一个单例类的对象，接下来复原多个那个对象，那你就会有多个单例类的实例。<br/><br/></span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;">对第一个问题修复的办法是：</p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Class getClass(String classname)      <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">                                         </span><span style="color: rgb(0, 0, 255);">throws</span><span style="color: rgb(0, 0, 0);"> ClassNotFoundException {     <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">      ClassLoader classLoader </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> Thread.currentThread().getContextClassLoader();     <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">      <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">      </span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(classLoader </span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)     <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">         classLoader </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> Singleton.</span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);">.getClassLoader();     <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">      <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">      </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> (classLoader.loadClass(classname));     <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">   }     <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">}  <br/></span><span style="color: rgb(0, 128, 128);">11</span> </span></div><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"> </p><p><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 0, 0); font-size: 10pt;"> 对第二个问题修复的办法是：</span> </span></p><p style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"></p><div style="border: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; width: 1265.17px; font-size: 13px; word-break: break-all; background-color: rgb(238, 238, 238);"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><span style="color: rgb(0, 128, 128);"> 1</span> <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">class</span><span style="color: rgb(0, 0, 0);"> Singleton </span><span style="color: rgb(0, 0, 255);">implements</span><span style="color: rgb(0, 0, 0);"> java.io.Serializable {     <br/></span><span style="color: rgb(0, 128, 128);"> 2</span> <span style="color: rgb(0, 0, 0);">   </span><span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);"> Singleton INSTANCE </span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 255);">new</span><span style="color: rgb(0, 0, 0);"> Singleton();     <br/></span><span style="color: rgb(0, 128, 128);"> 3</span> <span style="color: rgb(0, 0, 0);">      <br/></span><span style="color: rgb(0, 128, 128);"> 4</span> <span style="color: rgb(0, 0, 0);">   </span><span style="color: rgb(0, 0, 255);">protected</span><span style="color: rgb(0, 0, 0);"> Singleton() {     <br/></span><span style="color: rgb(0, 128, 128);"> 5</span> <span style="color: rgb(0, 0, 0);">        <br/></span><span style="color: rgb(0, 128, 128);"> 6</span> <span style="color: rgb(0, 0, 0);">   }     <br/></span><span style="color: rgb(0, 128, 128);"> 7</span> <span style="color: rgb(0, 0, 0);">   </span><span style="color: rgb(0, 0, 255);">private</span><span style="color: rgb(0, 0, 0);"> Object readResolve() {     <br/></span><span style="color: rgb(0, 128, 128);"> 8</span> <span style="color: rgb(0, 0, 0);">            </span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);"> INSTANCE;     <br/></span><span style="color: rgb(0, 128, 128);"> 9</span> <span style="color: rgb(0, 0, 0);">      }    <br/></span><span style="color: rgb(0, 128, 128);">10</span> <span style="color: rgb(0, 0, 0);">}   <br/></span><span style="color: rgb(0, 128, 128);">11</span> </span></div><div style="padding: 0px; margin: 0px; font-family: Arial, sans-serif, Helvetica, Tahoma; font-size: 12px;"><span style="color: black;"><span style="font-family: georgia, verdana, Arial, helvetica, sans-seriff;"><br/></span></span></div></div></span>
</div></body></html> 